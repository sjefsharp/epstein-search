# i18n Patterns

## Setup

- `next-intl` with `next-intl/plugin` in `next.config.ts`
- Routing config: `src/i18n/routing.ts` — `defineRouting()` with `localePrefix: 'always'`
- Message loader: `src/i18n/request.ts` — dynamic import from `messages/{locale}.json`
- Middleware: `src/middleware.ts` — `createMiddleware(routing)`, matcher excludes `/api`, `/_next`, static files

## Locale type

```ts
type SupportedLocale = "en" | "nl" | "fr" | "de" | "es" | "pt";
```

This type is **redeclared in every API route file** (not imported from a shared location). Keep them in sync manually.

## normalizeLocale helper

Every API route has a local `normalizeLocale()` function that maps `Accept-Language`-style strings to `SupportedLocale`. Pattern:

```ts
const normalizeLocale = (locale?: string): SupportedLocale => {
  if (!locale) return "en";
  const normalized = locale.toLowerCase();
  if (normalized.startsWith("nl")) return "nl";
  // ...etc for each locale
  return "en";
};
```

## ERROR_MESSAGES pattern

Every API route defines a `ERROR_MESSAGES` record keyed by `SupportedLocale` with route-specific error strings. When adding a new API route, follow this pattern exactly.

## Message files

- Location: `messages/{locale}.json` (root-level)
- Structure: flat namespace objects (`HomePage`, `ChatContainer`, `Errors`, `Metadata`, etc.)
- Client usage: `useTranslations("Namespace")` from `next-intl`
- Server usage: `getTranslations({ locale, namespace })` from `next-intl/server`
- Static params: `generateStaticParams()` in layout returns all `routing.locales`

## Adding a new locale

1. Add to `routing.locales` array in `src/i18n/routing.ts`
2. Create `messages/{locale}.json` (copy from `en.json`, translate)
3. Add locale branch to every `normalizeLocale()` function in API routes
4. Add locale key to every `ERROR_MESSAGES` and `SUMMARY_PROMPTS` record
5. Add locale to `SupportedLocale` type in every file that declares it
